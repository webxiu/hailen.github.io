import{E as Y}from"./index-bbff4ae8.js";import{u as Z,g as ee,s as te,a as ae}from"./common-9825d308.js";import{aF as v,r as c,U as k,h as le,aG as w,aH as i,aI as ne,aJ as oe,aK as re,aL as se,aM as ce,aN as ue,ac as E,aO as H}from"./index-d867314b.js";import{formConfigs as ie}from"./config-041ecf4e.js";import de from"./Bpmn-042821fe.js";import"./TitleCate-8bc9e876.js";const pe=n=>v.request("post","/edit-table/list",{data:n}),fe=n=>v.request("post","/test/add",{data:n}),me=n=>v.request("post","/test/update",{data:n}),ge=n=>v.request("post","/test/delete",{data:n}),be="/api";function Te(){const n=c(),C=c(),m=c(!0),x=c([]),d=c([]),h=c(),y=k({name:""}),p=c({loading:!1,text:""}),M=Z(".app-main .el-scrollbar",20+70+48),g=k({total:0,pageSize:20,small:!1,background:!0,align:"right",currentPage:1,pageSizes:[20,40,60]}),F=c({username:{key:"username",label:"用户名",value:"张三xx",valueLabel:""},status:{key:"status",label:"状态",readonly:!0,value:1,valueLabel:"正常"},date:{key:"date",label:"时间",value:"2020-05-08 ~ 2022-06-25",valueLabel:""}}),I=[{label:"ID",value:"id"},{label:"用户名",value:"username"},{label:"年龄",value:"age"},{label:"状态",value:"status",readonly:!0,children:[{label:"开启",value:1},{label:"关闭",value:0}]},{label:"组织名称",value:"uname",children:[{label:"零度空间",value:"零度空间"},{label:"利达科技",value:"利达科技"}]},{label:"日期1",value:"date"},{label:"日期2",value:"date2"}];le(()=>{L()});const L=()=>{const{editCellRenderer:e,editSelectRenderer:t}=ee(d,a=>{const{prop:u,index:s,value:f,row:S}=a;if(d.value[s][u]=f,u==="position"){V(d,d.value[s]);return}}),o=[{label:"待处理",value:0},{label:"进行中",value:1},{label:"已处理",value:2},{label:"已完成",value:3}],l={0:"#909399",1:"#e6a23c",2:"#409eff",3:"#67c23a",4:"#DC143C"},r=[{label:"排序",prop:"position",width:55,align:"center",cellRenderer:a=>e(a,!0)},{label:"星级",prop:"star"},{label:"组织ID",prop:"id",minWidth:180},{label:"用户名(可编辑)",prop:"username",cellRenderer:a=>e(a,!0)},{label:"年龄(可编辑)",prop:"age",cellRenderer:a=>e(a,!0)},{label:"状态(下拉编辑)",prop:"state",cellRenderer:a=>t(a,o,!0,{background:l[a.row[a.column.property]]})},{label:"颜色",prop:"color"},{label:"描述",prop:"desc"},{label:"标题",prop:"title"},{label:"金额",prop:"money"},{label:"词语",prop:"word"},{label:"日期",prop:"borth"},{label:"创建时间",prop:"createTime"},{label:"更新时间",prop:"updateTime"}];x.value=te({columnData:r,showOpt:!0,showSelection:!0,indexColumn:!1})},_=e=>{y.name=e,b()};async function b(){try{m.value=!0;const t=(await pe(y)).data.map((o,l)=>({position:l+1,...o}));d.value=t,g.total=t.length,g.pageSize=100,g.currentPage=1,m.value=!1}catch{m.value=!1}}const T=e=>(...t)=>{if(!h.value)return i("请选择一条数据",{type:"error"});e.call(null,...t)},B=()=>{ae([{dataList:d.value,columns:x.value,fileName:"表格数据"}])},O=e=>{e&&(e.resetFields(),b())},U=()=>{D("add")},q=T(({text:e})=>{D("edit",h.value)});function D(e,t){const l={add:"添加",edit:"编辑"}[e],r={id:(t==null?void 0:t.id)??"",username:(t==null?void 0:t.username)??"",age:(t==null?void 0:t.age)??""};w({title:`${l}组织`,props:{formInline:r,formConfigs:ie(e)},width:"75%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>E(Y,{ref:n}),beforeSure:(a,{options:u})=>{const s=n.value.getRef(),f=u.props.formInline;s.validate(S=>{S&&H.confirm("确认要提交吗?","系统提示",{type:"warning",draggable:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then(()=>{A(e,l,f,()=>{a(),b()})}).catch(()=>{})})}})}const A=(e,t,o,l)=>{({add:fe,edit:me})[e](o).then(a=>{if(a.code!==200)throw a.message;l(),i(`${t}成功`,{type:"success"})}).catch(a=>{})};function P(e){ge({id:e.id}).then(t=>{i("删除成功",{type:"success"}),b()}).catch(t=>{})}const z=T(({text:e})=>{w({title:"部署流程设计文件",props:{dataMsg:{dataMsg:666}},width:"640px",draggable:!0,fullscreen:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>E(de,{ref:n}),beforeSure:(t,{options:o})=>{const l=n.value.getRef();if(!l)return i("请保存模型",{type:"error"});H.confirm("确认提交吗","系统提示",{type:"warning",draggable:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then(()=>{const r=new FormData,a=`${l.name}.xml`,u=new File([l.data],a,{type:"text/xml"});r.append("files",u),r.append("deployName",l.name)}).catch(console.log)}})}),R=({text:e})=>{p.value={text:e,loading:!0},function(){setTimeout(()=>{p.value={text:e,loading:!1}},3e3)}()},N=e=>(p.value={text:"导入Excel",loading:!0},["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(e.type)?e.size/1024/1024>5?(i("文件大小不能超过5MB！",{type:"warning"}),!1):!0:(i("文件必须为xls或xlsx格式!",{type:"warning"}),!1));function $(e){p.value={text:"导入Excel",loading:!1},i("导入成功")}function j(e){p.value={text:"导入Excel",loading:!1},i("导入失败",{type:"error"})}function W(e){}function G(e){}function J(e){}const K=e=>{var t;(t=C.value)==null||t.getTableRef().toggleRowSelection(e)};function Q(e){h.value=e}const V=(e,t,o)=>{let l=Number(t.position);o&&(l+=o==="up"?-1:1);const r=e.value.length,a=e.value.filter(({uuid:s})=>s!==t.uuid),u=l>=r?r-1:l<=0?0:l-1;a.splice(u,0,t),a.forEach((s,f)=>s.position=f+1),e.value=a},X=c([{clickHandler:U,type:"primary",icon:ne,text:"添加数据",isDropDown:!1},{clickHandler:B,type:"warnint",icon:oe,text:"导出",isDropDown:!1},{clickHandler:z,type:"success",icon:re,text:"流程图",isDropDown:!1},{clickHandler:q,type:"default",icon:se,text:"编辑",isDropDown:!0},{clickHandler:R,type:"primary",icon:ce,text:"打印(-)",isDropDown:!0},{clickHandler:R,type:"danger",text:"上传",isDropDown:!0,icon:ue,uploadProp:{accept:".xls,.xlsx",action:`${be}/oa/hr/attendanceSummary/uploadExcel`,onSuccess:$,onError:j,beforeUpload:N}}]);return{queryParams:F,tableRef:C,formData:y,maxHeight:M,loading:m,columns:x,dataList:d,pagination:g,buttonList:X,searchOptions:I,onSearch:_,resetForm:O,openDialog:D,handleDelete:P,onRowClick:K,handleSizeChange:W,onCurrentChange:Q,handleCurrentChange:G,handleSelectionChange:J}}export{Te as useTable};
