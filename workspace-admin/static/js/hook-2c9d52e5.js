import{_ as D}from"./form.vue_vue_type_script_setup_true_lang-c10fe21e.js";import{getColumns as h}from"./config-f3a29ba7.js";import{aF as b,r,S as I,h as F,ar as S,aG as U,ab as _,aH as k,az as q}from"./index-dea993d1.js";import{u as E}from"./common-b77c58cb.js";import{o as P}from"./orgList-8ca76299.js";import"./sortable.esm-9c3c89c5.js";const G=n=>b.request("post","/config/usermove/list",{data:n}),N=n=>b.request("post","/config/usermove/copy",{data:n});function W(){const n=r(),v=r(),i=r(!0),l=r([]),u=r([]),g=r([]),d=r([]),M=E(".app-main .el-scrollbar",64+60+64),a=I({orgId:"",userCode:"",userName:"",page:1,limit:20}),c=I({total:0,pageSize:20,currentPage:1,pageSizes:[20,50,100,200,500,1e3],background:!0});F(()=>{R()});async function s(){try{i.value=!0;const t=(await G(a)).data;g.value=t.records,a.page=t.current,a.limit=t.size,c.total=t.total,c.pageSize=t.size,c.currentPage=t.current,i.value=!1,u.value=h(g,a)}catch{i.value=!1,u.value=h(r([]),a)}}async function R(){P({}).then(e=>{const t=e.data,o=t.map(({shortName:m,id:p})=>({label:m,value:p}));a.orgId=t[0].id,l.value=o,s()}).catch(e=>{S(e.toString(),{type:"error"})})}const y=e=>{e&&(e.resetFields(),s())};function z(e){a.limit=e,s()}function C(e){a.page=e,s()}function w(e){d.value=e}const x=()=>{if(d.value.length===0)return S("请选择员工",{type:"error"});f(d.value)},H=e=>{f([e])};function f(e){const t=e.map(o=>o.id);U({title:"用户迁移",props:{formInline:{newOrgId:"",userIds:t},userRows:e,tableRef:v.value.getTableRef(),orgOptions:l.value.filter(o=>o.value!==a.orgId)},width:"460px",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>_(D,{ref:n}),beforeSure:(o,{options:m})=>{const p=n.value.getRef(),L=m.props.formInline,T={userIds:t,oldOrgId:a.orgId,...L};p.validate(B=>{B&&k.confirm("确认要提交吗?","系统提示",{type:"warning",draggable:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then(()=>{O(T,()=>o())})})}})}const O=(e,t)=>{N(e).then(o=>{if(!o.data)throw o.message;q.success("迁移成功"),t()}).catch(o=>{})};return{moveTableRef:v,formData:a,orgOptions:l,loading:i,columns:u,dataList:g,pagination:c,onSearch:s,maxHeight:M,onMoveHandle:H,onBatchMoveHandle:x,resetForm:y,openDialog:f,handleSizeChange:z,handleCurrentChange:C,handleSelectionChange:w}}export{W as useRole};
