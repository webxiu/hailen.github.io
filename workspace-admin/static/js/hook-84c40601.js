import{E as F}from"./index-dbb811aa.js";import{aE as m,r as l,S as v,h as M,ay as s,aF as P,ab as q,aN as x}from"./index-9e436c07.js";import{formConfigs as E,getColumns as K}from"./config-7a084bf3.js";import{o as $}from"./orgList-c5e2eb9e.js";import{s as j}from"./common-d40e9681.js";import"./TitleCate-380701be.js";const H=a=>m.request("post","/config/kingdee/list",{data:a}),U=a=>m.request("post","/config/kingdee/insertkingdee",{data:a}),W=a=>m.request("post","/config/kingdee/updatekingdee",{data:a}),_=a=>m.request("post","/config/kingdee/deletekingdee",{data:a});function w(){const a=l(),p=l(),d=l(!1),h=l([]),r=l([]),b=l([]),g=v({total:0,pageSize:10,currentPage:1,background:!0}),u=v({accountName:"",limit:20,page:1}),k=[{label:"ID",value:"id"},{label:"数据库简称",value:"accountName"},{label:"IP地址",value:"ipAddress"},{label:"连接数据库名称",value:"linkDbName"},{label:"连接类型",value:"dbType"},{label:"用户名",value:"username"},{label:"密码",value:"password"},{label:"昵称",value:"nick"},{label:"状态",value:"accountStatus"},{label:"组织ID",value:"orgId"}];M(()=>{C(),D(),n()});async function D(){$({}).then(t=>{var i;const e=(i=t.data)==null?void 0:i.map(({id:c,orgName:f})=>({value:c,label:f}));r.value=e}).catch(t=>{r.value=[],s.error(t.toString()||"组织列表获取失败")})}const C=()=>{const t=K(r);h.value=j({columnData:t,showOpt:!0,showRadio:!0,operateWidth:140})};function S(t){u.accountName=t.accountName,n()}function n(){d.value=!1,H(u).then(t=>{const e=t.data;b.value=e,g.total=e.length,g.pageSize=100,g.currentPage=1,d.value=!1}).catch(t=>{d.value=!1,s.error(t.toString()||"列表获取失败")})}const I=t=>{t&&(t.resetFields(),n())};async function N(t,e){try{const c={add:"添加",edit:"编辑"}[t],f={id:(e==null?void 0:e.id)??"",accountName:(e==null?void 0:e.accountName)??"",ipAddress:(e==null?void 0:e.ipAddress)??"",linkDbName:(e==null?void 0:e.linkDbName)??"",dbType:(e==null?void 0:e.dbType)??"",username:(e==null?void 0:e.username)??"",password:(e==null?void 0:e.password)??"",nick:(e==null?void 0:e.nick)??"",accountStatus:(e==null?void 0:e.accountStatus)??"",orgId:(e==null?void 0:e.orgId)??""};P({title:`${c}数据库`,props:{type:t,formInline:f,formConfigs:E(t,r.value)},width:"75%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>q(F,{ref:a}),beforeSure:(o,{options:B})=>{const L=a.value.getRef(),A=B.props.formInline;L.validate(z=>{z&&x.confirm("确认要提交吗?","系统提示",{type:"warning",draggable:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then(()=>{R(t,c,A,()=>{o(),n()})}).catch(()=>{})})}})}catch{s.error("组织列表获取失败")}}const R=(t,e,i,c)=>{({add:U,edit:W})[t](i).then(o=>{if(o.code!==200)throw o.message;c(),s.success(`${e}成功`)}).catch(o=>{s.error(o||`${e}失败`)})};function O(t){_({id:t.id}).then(e=>{if(e.code!==200)throw e.message;s.success("删除成功"),n()}).catch(e=>{s.error("删除失败")})}function T(t){u.limit=t,n()}function y(t){u.page=t,n()}return{tableRef:p,formData:u,loading:d,columns:h,dataList:b,pagination:g,searchOptions:k,onSearch:S,resetForm:I,openDialog:N,onRowClick:t=>{var e;(e=p.value)==null||e.getTableRef().toggleRowSelection(t)},handleDelete:O,handleSizeChange:T,handleCurrentChange:y}}export{w as useConfig};
